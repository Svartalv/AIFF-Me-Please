# FLAC2AIFF for CDJ

A macOS application for batch-converting FLAC audio files to AIFF format, optimized for use with Pioneer CDJ/XDJ players.

## Features

- **Batch Conversion**: Convert entire folders of FLAC files to AIFF
- **Tag Preservation**: Automatically preserves metadata (Artist, Title, Album, etc.) and writes ID3 tags to AIFF files
- **CDJ-Optimized**: Default settings (44.1 kHz, 16-bit, stereo) are optimized for Pioneer CDJ/XDJ compatibility
- **Customizable Filenames**: Template-based filename generation (e.g., `{artist} - {title}.aiff`)
- **Progress Tracking**: Real-time progress bar and per-file status updates
- **Comprehensive Logging**: Detailed log files for troubleshooting
- **Safe by Default**: Never overwrites existing files unless explicitly enabled

## Installation

### Option 1: Use Pre-built .app (Recommended)

1. Download the `FLAC2AIFF.app` bundle
2. Drag it to your Applications folder
3. Double-click to launch

**Note**: On first launch, macOS may warn about an unidentified developer. To allow:
- Go to System Preferences → Security & Privacy
- Click "Open Anyway" next to the warning message

### Option 2: Build from Source

1. Install Python 3.8+ and pip
2. Install dependencies:
   ```bash
   pip install -r requirements.txt
   ```
3. Set up ffmpeg binary:
   ```bash
   ./setup_ffmpeg.sh
   ```
   Or manually copy ffmpeg to `resources/ffmpeg/ffmpeg`
4. (Optional) Run in development mode:
   ```bash
   python run.py
   ```
5. Build the app:
   ```bash
   pip install pyinstaller
   pyinstaller FLAC2AIFF.spec
   ```
6. The `.app` bundle will be in the `dist/` directory

## Usage

### Basic Workflow

1. **Launch the app** by double-clicking `FLAC2AIFF.app`
2. **Select input folder**: Click "Choose..." next to "Input folder" and select the folder containing your FLAC files
3. **Select output folder** (optional): The app will suggest `<input>_AIFF` by default, or choose your own
4. **Configure settings** (optional):
   - Bit depth: 16-bit (default) or 24-bit
   - Embed artwork: Enable to include album art in AIFF files
   - Overwrite existing files: Enable to replace existing output files
   - Max concurrent jobs: Number of parallel conversions (1-8)
   - Filename pattern: Customize output filename format
5. **Click "Start"** to begin conversion
6. **Monitor progress**: Watch the progress bar and current file status
7. **Review results**: Click "Open Output" to view converted files, or "Open Log" to see detailed logs

### Filename Templates

The default filename pattern is `{artist} - {title}`, which produces files like:
- `Daft Punk - One More Time.aiff`

Available placeholders:
- `{artist}` - Artist name
- `{title}` - Track title
- `{album}` - Album name
- Any other tag field (e.g., `{genre}`, `{year}`)

If artist or title tags are missing, the app will fall back to the original filename.

### Audio Settings

- **Sample Rate**: Fixed at 44.1 kHz (CDJ standard)
- **Bit Depth**: 16-bit (default) or 24-bit
- **Channels**: Always stereo (2 channels)

## Configuration

The app stores configuration in:
```
~/Library/Application Support/FLAC2AIFF/config.json
```

You can edit this file directly, or changes made in the GUI are automatically saved.

## Tag Mapping

The following FLAC tags are preserved in AIFF/ID3 format:

| FLAC Tag | ID3 Frame | Description |
|----------|-----------|-------------|
| ARTIST | TPE1 | Artist name |
| ALBUMARTIST | TPE2 | Album artist |
| TITLE | TIT2 | Track title |
| ALBUM | TALB | Album name |
| DATE/YEAR | TDRC | Release date |
| GENRE | TCON | Genre |
| TRACKNUMBER | TRCK | Track number |
| DISCNUMBER | TPOS | Disc number |
| COMMENT | COMM | Comments |
| LABEL | TPUB | Record label |

## Troubleshooting

### "ffmpeg not found" Error

The app includes a bundled ffmpeg binary. If you see this error:
1. Ensure you're using the packaged `.app` bundle (not running from source)
2. Check that the app bundle is not corrupted
3. Try rebuilding the app with PyInstaller

### Files Not Converting

- Check the log file (click "Open Log") for detailed error messages
- Ensure input files are valid FLAC files
- Verify you have write permissions for the output folder
- Check available disk space

### Tags Not Appearing in Rekordbox/CDJ

- Ensure your FLAC files have proper tags
- Try enabling "Embed artwork" if album art is missing
- Verify the converted AIFF files have the `.aiff` extension
- Some CDJ models may have limitations with certain tag fields

### App Won't Launch

- Ensure you're running macOS 10.13 or later
- Check Console.app for crash logs
- Try running from terminal: `open -a FLAC2AIFF.app`
- Rebuild the app if issues persist

## Known Limitations

- Only converts FLAC files (other formats are skipped)
- Sample rate is fixed at 44.1 kHz
- No audio normalization or DSP processing
- Artwork embedding may fail for some image formats (conversion continues with warning)

## Development

### Project Structure

```
.
├── app/
│   ├── __init__.py
│   ├── main.py          # Entry point
│   ├── gui.py           # Tkinter interface
│   ├── engine.py        # Conversion orchestration
│   ├── transcode.py     # FFmpeg wrapper
│   ├── tags.py          # Tag reading/writing
│   ├── naming.py        # Filename generation
│   ├── config.py        # Configuration management
│   └── logging_utils.py # Logging utilities
├── resources/
│   └── ffmpeg/          # Bundled ffmpeg binary
├── tests/               # Unit tests
├── config.default.json  # Default configuration
├── requirements.txt     # Python dependencies
├── FLAC2AIFF.spec      # PyInstaller spec
└── README.md
```

### Running Tests

```bash
python -m pytest tests/
```

### Building the App

```bash
pyinstaller FLAC2AIFF.spec
```

## License

[Add your license here]

## Credits

Built with:
- Python 3.8+
- Tkinter (GUI)
- Mutagen (tag handling)
- FFmpeg (audio conversion)
- PyInstaller (packaging)

