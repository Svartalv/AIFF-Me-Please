# FLAC2AIFF for CDJ - Project Summary

## Project Overview

A macOS application for batch-converting FLAC audio files to AIFF format, optimized for Pioneer CDJ/XDJ players. Built with Python, Tkinter, and ffmpeg.

## Project Structure

```
AIFF Me Please/
├── app/                          # Main application code
│   ├── __init__.py
│   ├── main.py                   # Entry point
│   ├── gui.py                    # Tkinter GUI interface
│   ├── engine.py                 # Conversion orchestration
│   ├── transcode.py              # FFmpeg wrapper
│   ├── tags.py                   # FLAC/AIFF tag handling
│   ├── naming.py                 # Filename generation
│   ├── config.py                 # Configuration management
│   └── logging_utils.py          # Logging utilities
├── resources/
│   └── ffmpeg/                   # FFmpeg binary location
│       ├── README.md
│       └── ffmpeg                 # (to be added)
├── tests/                        # Unit tests
│   ├── __init__.py
│   └── test_naming.py
├── config.default.json            # Default configuration
├── requirements.txt              # Python dependencies
├── FLAC2AIFF.spec                # PyInstaller spec file
├── setup_ffmpeg.sh               # FFmpeg setup script
├── run.py                        # Development entry point
├── README.md                     # User documentation
├── BUILD.md                      # Build instructions
├── LICENSE                       # MIT License
└── .gitignore                    # Git ignore rules
```

## Key Features Implemented

### ✅ Core Functionality
- [x] Batch FLAC to AIFF conversion
- [x] Tag preservation (FLAC → ID3 in AIFF)
- [x] Customizable filename templates
- [x] Progress tracking with UI updates
- [x] Comprehensive logging
- [x] Error handling and recovery

### ✅ Audio Settings
- [x] 44.1 kHz sample rate (fixed, CDJ standard)
- [x] 16-bit or 24-bit bit depth selection
- [x] Stereo output (fixed)
- [x] No normalization/DSP (as specified)

### ✅ Tag Handling
- [x] Read FLAC tags (Artist, Title, Album, etc.)
- [x] Write ID3 tags to AIFF
- [x] Artwork embedding (optional)
- [x] Tag mapping (FLAC → ID3 frames)
- [x] Fallback to filename if tags missing

### ✅ Filename Generation
- [x] Template-based naming (`{artist} - {title}`)
- [x] Character sanitization (removes unsafe chars)
- [x] Collision handling (appends (2), (3), etc.)
- [x] Fallback to original filename

### ✅ User Interface
- [x] Folder selection (input/output)
- [x] Settings panel (bit depth, artwork, overwrite, etc.)
- [x] Progress bar and current file display
- [x] Start/Cancel buttons
- [x] Open Output/Log buttons
- [x] Summary dialog on completion

### ✅ Safety & Reliability
- [x] Never overwrites by default
- [x] Skips non-FLAC files gracefully
- [x] Creates output directories as needed
- [x] Per-file error handling (continues on failure)
- [x] Detailed logging for troubleshooting

### ✅ Packaging
- [x] PyInstaller spec file
- [x] Bundles ffmpeg binary
- [x] Self-contained .app bundle
- [x] No external dependencies required

## Technical Stack

- **Language**: Python 3.8+
- **GUI**: Tkinter (built-in, no extra dependencies)
- **Audio**: FFmpeg (bundled binary)
- **Tagging**: Mutagen library
- **Packaging**: PyInstaller
- **Concurrency**: ThreadPoolExecutor (configurable)

## Configuration

Configuration is stored in:
```
~/Library/Application Support/FLAC2AIFF/config.json
```

Settings include:
- Bit depth (16/24)
- Sample rate (44100, fixed)
- Embed artwork (boolean)
- Overwrite existing files (boolean)
- Concurrency level (1-8)
- Filename template (string)
- Log level (debug/info/warning/error)

## Tag Mapping

| FLAC Tag | ID3 Frame | Description |
|----------|-----------|-------------|
| ARTIST | TPE1 | Artist name |
| ALBUMARTIST | TPE2 | Album artist |
| TITLE | TIT2 | Track title |
| ALBUM | TALB | Album name |
| DATE/YEAR | TDRC | Release date |
| GENRE | TCON | Genre |
| TRACKNUMBER | TRCK | Track number |
| DISCNUMBER | TPOS | Disc number |
| COMMENT | COMM | Comments |
| LABEL | TPUB | Record label |
| (artwork) | APIC | Album art (if enabled) |

## Next Steps for Deployment

1. **Obtain FFmpeg Binary**
   - Run `./setup_ffmpeg.sh` or manually copy to `resources/ffmpeg/ffmpeg`

2. **Test in Development**
   - Run `python run.py` to test the GUI
   - Test with sample FLAC files

3. **Build App Bundle**
   - Run `pyinstaller FLAC2AIFF.spec`
   - Test the resulting `.app` bundle

4. **Code Signing (Optional)**
   - For distribution, consider code signing the app
   - Requires Apple Developer account

5. **Distribution**
   - Zip the `.app` bundle
   - Provide download link
   - Include README with usage instructions

## Known Limitations

- Only converts FLAC files (other formats skipped)
- Sample rate fixed at 44.1 kHz (CDJ requirement)
- No audio normalization or DSP
- Artwork embedding may fail for some formats (continues with warning)
- Requires macOS 10.13+ (for Tkinter support)

## Testing Checklist

- [ ] Convert single FLAC file
- [ ] Convert folder with multiple FLAC files
- [ ] Test with files missing tags (fallback to filename)
- [ ] Test with files containing unsafe characters in tags
- [ ] Test collision handling (duplicate filenames)
- [ ] Test overwrite option
- [ ] Test artwork embedding
- [ ] Test cancellation mid-conversion
- [ ] Verify tags appear correctly in Rekordbox
- [ ] Test with 16-bit and 24-bit settings
- [ ] Verify log file generation
- [ ] Test "Open Output" and "Open Log" buttons

## Future Enhancements (Post-MVP)

- Drag-and-drop support
- Dark mode
- App icon
- Presets (e.g., "CDJ Safe")
- Retain source bit depth option
- Batch processing from command line
- More tag fields support

